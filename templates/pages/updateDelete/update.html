{% extends "base.html" %}
 
{% block content %}
<div class="container">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
            {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    <div class="mb-3 text-start">
        <a href="{{ request.META.HTTP_REFERER }}" class="text-decoration-none" style="color: inherit; font-size: 0.9rem;">
          <i class="fas fa-arrow-circle-left me-1"></i> Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        </a>
    </div>
    {% if announce_form or course_form or homeWork_form or activity_form %}    
        {% if announce_form %}
            <center> <h4 class="text-dark"> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†  </h4> </center>
            <form action="{% url 'Update' announce_form.id %}?editing_data=announce" method="post">
                {% csrf_token %}
                <div class="">
                    <label for="">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                    <input type="title" class="form-control" name="title" value="{{announce_form.title}}" required>

                    <label for="">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                    <textarea type="content"  class="form-control"  name="content" id="" required>{{announce_form.content}}</textarea>

                    <div class="d-flex justify-content-end">
                        <button class="my-2 btn btn-outline-success">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
                    </div>
                </div>
            </form>
        {% endif %}

        {% if course_form %}
            <center> <h4 class="text-dark"> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø³ </h4> </center>
            <form action="{% url 'Update' course_form.id %}?editing_data=course" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="">
                    <label class="mt-2"  for="">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³</label>
                    <input type="title" class="form-control" name="title" value="{{course_form.title}}" required>

                    <label class="mt-2" for="">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select class="form-control" name="material" required>
                        {% for m in all_materials %}
                        <option value="{{m.name}}" {% if m == course_form.material %}selected{% endif %}> {{m.name}} </option>
                        {% endfor %}
                    </select>
                    <br>
                    <label class="mt-2" for="">Ø§Ù„Ù‚Ø³Ù…:</label>
                    <select class="form-control"  name="section" multiple >
                        {% for s in all_sections %}
                        <option value="{{s.name}}"  {% if s in course_form.section.all %}selected{% endif %}>{{s.name}}</option>
                        {% endfor %}
                    </select>
                    <br>

                    <label class="mt-2" for="">Ù…Ù‚Ø¯Ù…Ø© Ø§Ù„Ø¯Ø±Ø³</label>
                    <textarea type="text"  class="form-control"  name="introduction" required>{{course_form.introduction}}</textarea>

                    <label class="mt-2" for="">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³</label>
                    <textarea type="text"  class="form-control"  name="subject" rows="9" required>{{course_form.subject}}</textarea>

                    <label class="mt-2" for="">Ø®Ø§ØªÙ…Ø© Ø§Ù„Ø¯Ø±Ø³</label>
                    <textarea type="text"  class="form-control"  name="conclusion" required>{{course_form.conclusion}}</textarea>

                    <br>
                    {% if course_form.image_set.all %}
                        <label class="mt-2" for=""> Ù…Ù„Ø­Ù‚Ø§Øª <p style="font-size: small; display:inline-block">(Ù…Ù† Ø£Ø¬Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù†Ø­Ùˆ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)</p></label>
                            {% for i in course_form.image_set.all %}
                                {% if i.image %}
                                    <br>
                                        <a class="text-dark" href="{{ i.image.url }}" target="_blank">ğŸ“‚ {{ i.title }}</a>
                                    <a href="http://127.0.0.1:8000/admin/home/image/{{i.id}}/change/" class="text-info" target="_blank">Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</a>
                                    <br>
                                {% else %}
                                    <p>Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ø­Ù‚ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØµÙˆØ±.</p>
                                {% endif %}
                            {% endfor %}
                    {% else %}
                        <h4 class="my-4">Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª</h4>
                        {{ CourseFormSet.management_form }} 
                        <div id="form-container"> 
                            {% for course_form in CourseFormSet %}
                                <div class="file-upload ">
                                    {{ course_form.as_p }}
                                    {% if not forloop.first %}
                                        <button type="button" class="remove-form">Ø¥Ø²Ø§Ù„Ø©</button>
                                    {% endif %}
                                    <br>
                                    <hr>
                                </div>
                            {% endfor %}
                        </div>
                        <button type="button" id="add-form" class="btn btn-secondary my-1">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ø¢Ø®Ø±</button>
                        {% endif %}

                    <div class="d-flex justify-content-end ">
                        <button class="my-2 btn btn-outline-success">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø³</button>
                    </div>
                </div>
            </form>
        {% endif %}
        
        {% if homeWork_form %}
            <center> <h4 class="text-info"> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ </h4> </center>
            <form action="{% url 'Update' homeWork_form.id %}?editing_data=homework" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="">
                    <label class="mt-2" for="">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                    <input type="title" class="form-control" name="title" value="{{homeWork_form.title}}" required>

                    <label class="mt-2" for="">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <textarea type="text"  class="form-control"  name="material" required>{{homeWork_form.material}}</textarea>

                    <label class="mt-2" for="">Ø§Ù„Ù‚Ø³Ù…</label>
                    <select class="form-control" name="section" multiple required>
                        {% for sec in all_sections %}
                            <option value="{{ sec.name }}" {% if sec in homeWork_form.section.all %}selected{% endif %}>
                                {{ sec.name }}
                            </option>
                        {% endfor %}
                    </select>
                    
                    <label class="mt-2" for=""> Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                    <textarea type="text"  class="form-control"  name="content" rows="9" required>{{homeWork_form.content}}</textarea>

                    <label class="mt-2" for="">Ø£Ø¬Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</label>
                    <input type="date" name="lastDate" required value="{{homeWork_form.lastDate|date:'Y-m-d'}}">

                    {% if homeWork_form.files_set.all %}
                        <br>
                        <label class="mt-2" for=""> Ù…Ù„Ø­Ù‚Ø§Øª <p style="font-size: small; display:inline-block">(Ù…Ù† Ø£Ø¬Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù†Ø­Ùˆ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)</p></label>
                        {% for f in homeWork_form.files_set.all %}
                            <br>
                            {% if f.file %}
                            <a class="text-dark" href="{{ f.file.url }}" target="_blank">ğŸ“‚ {{ f.file.name }}</a>
                            {% else %}
                            <p>Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ø­Ù‚ Ù„Ø§ ÙŠØªØ¶Ù…Ù† Ù…Ù„ÙØ§Øª</p>
                            {% endif %}
                            <a href="http://127.0.0.1:8000/admin/home/files/{{f.id}}/change/" class="text-info" target="_blank">Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</a>
                            <br>
                        {% endfor %}
                    {% else %}
                        <h4 class="my-4">Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª</h4>
                        {{ FileFormSet.management_form }} 
                        <div id="form-container"> 
                            {% for file_form in FileFormSet %}
                                <div class="file-upload ">
                                    {{ file_form.as_p }}
                                    {% if not forloop.first %}
                                        <button type="button" class="remove-form">Ø¥Ø²Ø§Ù„Ø©</button>
                                    {% endif %}
                                    <br>
                                    <hr>
                                </div>
                            {% endfor %}
                        </div>
                        <button type="button" id="add-form" class="btn btn-secondary my-1">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ø¢Ø®Ø±</button>
                        {% endif %}


                    <div class="d-flex justify-content-end ">
                        <button class="my-2 btn btn-outline-success">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</button>
                    </div>
                </div>
            </form>

        {% endif %}

        {% if activity_form %}
            <center> <h4 class="text-dark"> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø· </h4> </center>

            <form action="{% url 'Update' activity_form.id %}?editing_data=activity" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="">
                    <label class="mt-2"  for="">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø´Ø§Ø·</label>
                    <input type="title" class="form-control" name="title" value="{{activity_form.title}}" required>

                    <br>

                    <label class="mt-2" for="">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø§Ø·</label>
                    <textarea type="text"  class="form-control"  name="dateTime" required>{{activity_form.dateTime|date:'Y-m-d'}}</textarea>
                    
                    <br>
                    <label class="mt-2" for="">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø·</label>
                    <textarea type="text"  class="form-control"  name="content" rows="9" required>{{activity_form.content}}</textarea>


                    {% if activity_form.image_set.all %}
                        <label class="mt-2" for=""> Ù…Ù„Ø­Ù‚Ø§Øª <p style="font-size: small; display:inline-block">(Ù…Ù† Ø£Ø¬Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù†Ø­Ùˆ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)</p></label>
                            {% for i in activity_form.image_set.all %}
                                {% if i.image %}
                                    <br>
                                        <a class="text-dark" href="{{ i.image.url }}" target="_blank">ğŸ“‚ {{ i.title }}</a>
                                    <a href="http://127.0.0.1:8000/admin/home/image/{{i.id}}/change/" class="text-info" target="_blank">Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</a>
                                    <br>
                                {% else %}
                                    <p>Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ø­Ù‚ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØµÙˆØ±.</p>
                                {% endif %}
                            {% endfor %}
                    {% else %}
                        <h4 class="my-4">Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª</h4>
                        {{ activityFormSet.management_form }} 
                        <div id="form-container"> 
                            {% for activityForm in activityFormSet %}
                                <div class="file-upload ">
                                    {{ activityForm.as_p }}
                                    {% if not forloop.first %}
                                        <button type="button" class="remove-form">Ø¥Ø²Ø§Ù„Ø©</button>
                                    {% endif %}
                                    <br>
                                    <hr>
                                </div>
                            {% endfor %}
                        </div>
                        <button type="button" id="add-form" class="btn btn-secondary my-1">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ø¢Ø®Ø±</button>
                        {% endif %}

                    <div class="d-flex justify-content-end ">
                        <button class="my-2 btn btn-outline-success">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·</button>
                    </div>
                </div>
            </form>
        {% endif %}


    {% else %}
        <h4>{{message}}</h4>
    {% endif %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        let formContainer = document.getElementById("form-container");
        let addButton = document.getElementById("add-form");
        let totalForms = document.getElementById("id_form-TOTAL_FORMS");  
        let formIndex = parseInt(totalForms.value);  
        addButton.addEventListener("click", function() {
            let newForm = formContainer.children[0].cloneNode(true);
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆÙ…Ø³Ø­ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            newForm.querySelectorAll("input, select, textarea").forEach(input => {
                input.value = "";
                if (input.name) {
                    input.name = input.name.replace(/-\d+-/, `-${formIndex}-`);
                    input.id = input.id.replace(/-\d+-/, `-${formIndex}-`);
                }
            });
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø²Ø± Ø§Ù„Ø­Ø°Ù ÙˆØ¥Ø¸Ù‡Ø§Ø±Ù‡ ÙÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·
            let removeButton = newForm.querySelector(".remove-form");
            if (!removeButton) {
                removeButton = document.createElement("button");
                removeButton.type = "button";
                removeButton.classList.add("remove-form");
                removeButton.textContent = "Ø¥Ø²Ø§Ù„Ø©";
                newForm.appendChild(removeButton);
            } else {
                removeButton.style.display = "block";
            }
            formContainer.appendChild(newForm);
            formIndex++;
            totalForms.value = formIndex;
        });
        formContainer.addEventListener("click", function(e) {
            if (e.target.classList.contains("remove-form")) {
                e.target.parentElement.remove();
                formIndex--;
                totalForms.value = formIndex;
            }
        });
    });
</script>
    

{% endblock content %}
